generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ConsultationStatus {
  PENDING
  ACTIVE
  CLOSED
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String
  users User[]
}

model User {
  id           Int       @id @default(autoincrement())
  username     String    @unique
  email        String    @unique
  password     String
  birthdate    DateTime
  registeredAt DateTime  @default(now())
  roleId       Int
  role         Role      @relation(fields: [roleId], references: [id])

  posts             Post[]
  comments          Comment[]
  forums            Forum[]
  professional      Professional?
  messages          Message[]
  chatUsers         ChatUser[]
  consultationUsers ConsultationUser[]
  }

model Professional {
  id          Int    @id @default(autoincrement())
  userId      Int    @unique
  user        User   @relation(fields: [userId], references: [id])
  specialty   String
  registrationNumber String @unique
  bio         String?

  consultationProfessionals ConsultationProfessional[]
  }

model Forum {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  createdAt   DateTime @default(now())
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  posts       Post[]
  }

model Post {
  id          Int       @id @default(autoincrement())
  title       String
  content     String
  isAnonymous Boolean   @default(false)
  publishedAt DateTime  @default(now())
  forumId     Int
  userId      Int
  forum       Forum     @relation(fields: [forumId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  comments    Comment[]
}

model Library {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  icon        String?
  createdAt   DateTime @default(now())
}

model Comment {
  id         Int      @id @default(autoincrement())
  content    String
  commentedAt DateTime @default(now())
  postId     Int
  userId     Int
  post       Post @relation(fields: [postId], references: [id])
  user       User @relation(fields: [userId], references: [id])
}

model Chat {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  messages  Message[]
  chatUsers ChatUser[]
}

model ChatUser {
  chatId Int
  userId Int
  chat   Chat @relation(fields: [chatId], references: [id])
  user   User @relation(fields: [userId], references: [id])

  @@id([chatId, userId])
}

model Message {
  id       Int      @id @default(autoincrement())
  content  String
  sentAt   DateTime @default(now())
  chatId   Int
  userId   Int
  chat     Chat @relation(fields: [chatId], references: [id])
  user     User @relation(fields: [userId], references: [id])
}

model Consultation {
  id              Int      @id @default(autoincrement())
  reason          String
  consultationDate DateTime
  status          ConsultationStatus @default(PENDING)
  consultationUsers         ConsultationUser[]
  consultationProfessionals ConsultationProfessional[]
  }

model ConsultationUser {
  consultationId Int
  userId         Int
  consultation   Consultation @relation(fields: [consultationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@id([consultationId, userId])
}

model ConsultationProfessional {
  consultationId Int
  professionalId Int
  consultation   Consultation @relation(fields: [consultationId], references: [id])
  professional   Professional @relation(fields: [professionalId], references: [id])

  @@id([consultationId, professionalId])
}